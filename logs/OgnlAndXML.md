# XMLとOGNLが同居する世界でハマった話

今回は、実務で実際にハマった「XMLとOGNLが同居しているがゆえに起きた && 問題」について書きます。

### 背景:追加返礼品ページで、配送温度帯のアイコンを制御するタスクがありました

・常温のみ → アイコンは表示しない <br/>
・冷蔵 or 冷凍も可能 → 該当アイコンを表示する

Mayaaテンプレート上で、条件分岐を書こうとしました

<details><summary>最初に書いたコード（動かなかった）<summary>

```rb
<m:if test="${isNormal && isFrozen}">  <img src="frozen.png" /></m:if>
```

</details>

これは普通に動くはず」**と思っていました。
しかし、実際には エラー


<details><summary>正解はこうでした。<summary>

### && を &amp;&amp; にする

```rb
<m:if test="${isNormal &amp;&amp; isFrozen}">  <img src="frozen.png" /></m:if>
```
</details>


これで正常に条件分岐が動作しました。

## なぜ && がダメだったのか？

OGNL的には && は正しい
ただし、XMLとして不正
Mayaaでは「XML × OGNL」が同居している

今回の学びを一言で言うとこれです。Mayaaでは、XMLのルールが最優先。その中でOGNLが動く

${} の中に書いたとしても、XMLの制約は適用される

まとめ<br/>
・構造をしっかり把握しよう<br/>
・Mayaaは XML → OGNL の順で処理される

おわりに
正直、「知っていれば一瞬、知らないと数十分溶ける」そんなタイプの罠でした
まずは構造を把握すること
一見合ってるはずでエラーがコード上なくてもエラーが起きたら
もしかしたら構造上にタブーをしている可能性があるかもです。

同じところで詰まる人が一人でも減れば嬉しいです。
